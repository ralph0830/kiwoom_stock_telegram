# 📈 Telegram 자동매매 시스템 GUI

Streamlit 기반 웹 대시보드로 자동매매 시스템을 모니터링하고 제어합니다.

## 🚀 빠른 시작

### 1. Telegram 초기 인증 (최초 1회만)

세션 파일이 없는 경우 최초 1회만 인증이 필요합니다:

```bash
uv run python scripts/telegram_auth.py
```

프롬프트에 따라 다음을 입력:
1. 전화번호 (예: +821012345678)
2. SMS 인증 코드 (5자리)
3. 2단계 비밀번호 (설정된 경우)

인증 완료 시 `channel_copier.session` 파일이 생성됩니다.

### 2. GUI 실행

```bash
streamlit run gui/app.py
```

브라우저가 자동으로 열리며 `http://localhost:8501`로 접속됩니다.

---

## 📱 주요 기능

### 1. **Telegram 자동 재인증**
- GUI 시작 시 세션 자동 검증
- 세션 만료 시 GUI에서 바로 재인증 가능
- CLI 없이 웹 인터페이스에서 모든 인증 처리

### 2. **자동매매 프로세스 제어**
- ▶️ **시작**: auto_trading.py 백그라운드 실행
- ⏹️ **중지**: 실행 중인 프로세스 중지
- 🔄 **재시작**: 프로세스 재시작

### 3. **실시간 모니터링**
- 📊 프로세스 상태 (실행중/중지)
- 📡 Telegram 세션 상태 (활성/만료)
- 💰 오늘 매수 종목 정보
- 📜 실시간 로그 스트리밍

### 4. **매매 내역 조회**
- `trading_results/` 디렉토리의 모든 매매 기록 시각화
- 익절/손절/강제청산 내역 구분 표시
- 수익률 및 손익 금액 확인

### 5. **시스템 정보**
- 환경 설정 조회 (계좌, 투자금액, 목표수익률 등)
- 파일 상태 확인 (세션, 로그, 매수 이력)
- 프로세스 상세 정보

---

## 📋 사용 시나리오

### 시나리오 A: 정상 실행

```bash
# 1. GUI 실행
streamlit run gui/app.py

# 2. 세션 자동 검증 ✅
# 3. 사이드바에서 "▶️ 시작" 클릭
# 4. auto_trading.py가 백그라운드에서 실행됨
# 5. 실시간 로그 및 상태 모니터링
```

### 시나리오 B: 세션 만료 시

```bash
# 1. GUI 실행
streamlit run gui/app.py

# 2. 세션 검증 실패 ❌
# 3. 재인증 UI가 자동으로 표시됨
#    - 전화번호 입력
#    - SMS 코드 입력
#    - (필요시) 2단계 비밀번호 입력
# 4. 재인증 완료 ✅
# 5. 메인 대시보드로 자동 이동
```

### 시나리오 C: 실행 중 세션 만료

```bash
# 1. auto_trading.py 실행 중
# 2. Telegram 다른 기기에서 로그아웃
# 3. auto_trading.py가 세션 만료 감지 → 종료
# 4. GUI 사이드바에 "🚨 세션 만료!" 표시
# 5. "🔄 재인증" 버튼 클릭
# 6. 재인증 UI에서 인증 진행
# 7. 재인증 완료 후 "▶️ 시작" 클릭으로 재시작
```

---

## 🎨 UI 구성

### 사이드바 (좌측)
- **제어 패널**: 시작/중지/재시작 버튼
- **시스템 상태**: 프로세스 및 세션 상태 표시
- **Telegram 정보**: 로그인된 사용자 정보
- **재인증 옵션**: 수동 재인증 버튼

### 메인 화면 (우측)
- **상태 요약**: 4개 메트릭 카드 (프로세스, 세션, 매수종목, 로그크기)
- **탭 1 - 실시간 로그**: auto_trading.log 스트리밍 (자동 새로고침 옵션)
- **탭 2 - 매매 내역**: 최근 10개 매매 기록 시각화
- **탭 3 - 시스템 정보**: 환경 설정 및 파일 상태

---

## 🔐 재인증 프로세스

GUI에서 재인증이 필요한 경우:

### 1. 전화번호 입력
```
📱 전화번호를 입력하세요
+821012345678
[📤 인증 코드 전송]
```

### 2. SMS 코드 입력
```
📱 +821012345678로 전송된 인증 코드를 입력하세요
12345
[✅ 인증]  [← 다시 시작]
```

### 3. 2단계 비밀번호 (필요시)
```
🔒 2단계 인증 비밀번호를 입력하세요
••••••••
[🔓 로그인]  [← 다시 시작]
```

### 4. 완료
```
✅ 인증 완료!
🎈 (풍선 애니메이션)
→ 메인 대시보드로 자동 이동
```

---

## 📁 파일 구조

```
gui/
├── app.py                      # 메인 Streamlit 앱
├── utils/
│   ├── __init__.py
│   ├── telegram_auth.py       # Telegram 인증 관리자
│   └── process_monitor.py     # 프로세스 모니터
├── components/                 # (향후 확장)
├── pages/                      # (향후 확장)
└── README.md                   # 본 문서

scripts/
└── telegram_auth.py            # CLI 인증 스크립트
```

---

## 🛠️ 트러블슈팅

### Q1. GUI가 시작되지 않아요
```bash
# Streamlit 설치 확인
uv sync

# 수동으로 의존성 추가
uv add streamlit plotly pandas watchdog
```

### Q2. 세션 파일이 없다는 오류
```bash
# CLI로 초기 인증 실행
uv run python scripts/telegram_auth.py
```

또는 GUI에서 재인증 UI를 통해 인증 진행

### Q3. auto_trading.py가 시작되지 않아요
- GUI 터미널에서 에러 메시지 확인
- `.env` 파일 설정 확인
- `python auto_trading.py` 직접 실행하여 오류 확인

### Q4. 로그가 표시되지 않아요
- `auto_trading.log` 파일 존재 확인
- 파일 권한 확인
- 로그 라인 수 조정 (10~500)

### Q5. 재인증이 안돼요
- 전화번호 형식 확인 (+82 포함)
- SMS 코드 5자리 정확히 입력
- 코드 만료 시 "← 다시 시작" 클릭

---

## 🔧 고급 설정

### 원격 접속 설정

같은 네트워크의 다른 기기에서 접속:

```bash
streamlit run gui/app.py --server.address 0.0.0.0
```

스마트폰 또는 다른 PC에서:
```
http://[서버IP]:8501
예: http://192.168.0.10:8501
```

### 포트 변경

```bash
streamlit run gui/app.py --server.port 8080
```

---

## 🚀 향후 개발 계획

- [ ] 📊 실시간 시세 차트 (Plotly 캔들스틱)
- [ ] 📈 수익률 추이 그래프
- [ ] ⚙️ .env 편집 UI
- [ ] 📤 Telegram 알림 설정
- [ ] 🔔 브라우저 알림 (매수/매도 시)
- [ ] 📱 모바일 최적화

---

## 📝 참고

- **Streamlit 문서**: https://docs.streamlit.io
- **프로젝트 메인 README**: ../README.md
- **이슈 리포트**: GitHub Issues

---

**버전**: v1.6.0-GUI
**업데이트**: 2025-11-10
